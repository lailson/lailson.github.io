---
layout: post
title: Análise de Malware - PARTE1
description: "Análise estática e dinâmina de um malware. Uma visão prática"
modified: 2014-06-14
category: articles
tags: [malware, analise, estatica, dinamica, linux, wireshark, botnet, rxbot]
image:
  feature: figuraAnaliseMalware.jpg
  credit: Lailson Henrique
  creditlink: http://lailsonhenrique.com
comments: true
share: true
---

Este post mostra uma introdução à Análise de Malware mostrando passo-a-passo como devemos analisar de forma estática e dinâmica um malware. 
A análise 

#Analisando Malware

##Análise na web
 Inicialmente vamos submentar o nosso artefato a um site para ser avalisado por diersos antivirus. O site é <a href="http://virustotal.com">www.virustotal.com</a>
 <figure>
 	<img src="/images/virustotal.png">
 </figure>
 
Nesse caso o malware submetido pof analisado por 54 antivirus no qual 40 deles detectaram que este realmente é um malware.

##Ambiente Virtual
Nessa prática vamos utilizar o <a href="https://www.virtualbox.org/">Virtual Box</a> que é uma ferramentar para virtualizar ambientes, assim podemos simular (virtualizar) uma máquina windows xp e uma máquina linux (REMnux). 
Como vamos manipular um malware devemos tomar certos cuidados, para isso vamos criar uma rede host-only para que haja conexão apenas entre a máquina windows XP e Linux. 
Para faciliar segue o <a href="https://mega.co.nz/#!rsJx0LRK!a6whtxW014bzH2kDyv03an1hyhqvkwVXyOqBV84pJ5o">link da máquina xp</a> no formato .ova e do <a href="http://sourceforge.net/projects/remnux/files/version5/remnux-5.0-live-cd.iso/download"> linux no formato iso e <a href="http://sourceforge.net/projects/remnux/files/version5/remnux-5.0-ova-public.ova/download">no formato ova</a>
 <figure>
 	<img src="/images/analisemalware/Virtualbox.png">
 </figure>

##Análise Estática - Código
Vamos analisar o código utilizando um programa bintext <a href="http://b2b-download.mcafee.com/products/tools/foundstone/bintext303.zip">link</a> que é possível "ler" um código mesmo depois que o arquivo é compilado.
 <figure>
 	<img src="/images/analisemalware/bintext.png">
 </figure>
 Como mostra a figura a cima o código está ofuscado. Essa é uma técnica usada pelos malwares para tentar esconder seu código, para isso é utilizado programas conhecidos como packer. Pare tentar desofuscar o código iremos utilizao o UPX <a href="http://sourceforge.net/projects/upx/">link</a>
 <figure>
 	<img src="/images/analisemalware/upx.png">
 </figure>
Figura: upx 

##Análise Dinâmica - Comportamental
Utilizaremos o wireshark para verificar os pacotes que trafegam na rede. O wireshark é um snifer (bisbilhoteiro) que capture o tráfego da rede para análise.
Neste caso usaremos a versão do Remnux que ja vem com o wireshark instalado, mas primiero devemos criar uma rede host-only.
Para execute o wireshark pelo remnux utiliza-se o comando `sudo wireshark` e a senha do root é `malware`
 <figure>
 	<img src="/images/analisemalware/wireshark.png">
 </figure>

###Hosts
Na nossa experiência percebemos através do wireshark que nosso malware tenta se conectar com o servidor lailsonhenrique.com então vamos alterar o arquivo hosts para que o windowsxp pense que nossa máquina linux é o servidor lailsonhenrique.com
`C:\windows\system32\drivers\etc\hosts`
 <figure>
 	<img src="/images/analisemalware/hosts.png">
 </figure>
 Figura: Aterando arquivo Hosts
 
##IRC
O malware tenta se conectar a um servidor irc, sendo assim vamos utilizar o Remnux para estartar um servidor irc utilizando o comando `ircd start` depois vamos entrar no canal `#malware` e vamos perceber que o virus estar conectado a este canal, então vamos digitar alguns comandos para interagir com o malware
É necessário se autenticar para se comunicar com o malware para isso vamos digitar `.login aula` onde aula é a senha.

#Vídeo
Veja todo o processo no vídeo a baixo


link: https://www.youtube.com/watch?v=8MEjb4N5kTM

Video:

<embed width="420" height="315"
src="http://www.youtube.com/v/8MEjb4N5kTM">






