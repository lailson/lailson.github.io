<p>Hoje, o cenário da segurança digital não é um dos melhores. Sendo a informação o principal ativo de uma empresa, esta passa a ser bastante requisitada. A empresa <a href="http://imprima.com">imprima</a> mostrou uma imagem dos 20 paies que mais sofrem com ataques digitais. 
Tomar medidas para aumentar a segurança do seu servidor linux é primordial nos dias de hoje. Veremos aqui algumas delas:</p>
<figure>
 	<img src="/images/seguranca_linux/20countries.jpg" />
 </figure>

<ul id="markdown-toc">
  <li><a href="#instalando-antivirus">Instalando antivirus</a>    <ul>
      <li><a href="#kaspersky">Kaspersky</a></li>
    </ul>
  </li>
  <li><a href="#segurana-no-gestor-de-boot-grub">Segurança no gestor de boot: GRUB</a></li>
  <li><a href="#gerenciando-logs">Gerenciando Logs</a>    <ul>
      <li><a href="#configuraes-do-servidor-de-log">Configurações do servidor de log</a></li>
      <li><a href="#configurando-o-cliente-de-log">Configurando o cliente de log</a></li>
      <li><a href="#gravando-os-logs-no-mysql">Gravando os logs no MySQL</a></li>
    </ul>
  </li>
  <li><a href="#configurando-parties">Configurando Partições</a></li>
</ul>

<h1 id="instalando-antivirus">Instalando antivirus</h1>
<hr />
<p>##ClamAV
Instalando o ClamAV</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">apt-get install clamav</span>
<span class="l-Scalar-Plain">apt-get install arc bzip2 cabextract p7zip unzip unrar-free</span>
<span class="l-Scalar-Plain">/etc/init.d/clamav-freshclam status</span></code></pre></div>

<p>O EICAR test file(arquivo de teste, em português) é um arquivo de 68 bytes que possui uma linha de caracteres, desenvolvido pelo European Institute of Computer Anti-Virus Research (Instituto Europeu para Pesquisa de Antivírus de Computador), é usado para testar a eficiência dos antivírus na detecção de vírus conhecidos sem qualquer risco ao computador. Usar o EICAR ao invés de um vírus real para testar um antivírus, é a garantia de que o computador não será infectado.
Baixar o <a href="http://www.eicar.org/">Eicar</a>:</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">wget http://www.eicar.org/download/eicar.com</span></code></pre></div>

<p>Testando o ClamAv:</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">clamscan eicar.com</span></code></pre></div>

<p>Testando o ClamAV</p>
<figure>
 	<img src="/images/seguranca_linux/clamscan_eicar.png" />
 </figure>

<h2 id="kaspersky">Kaspersky</h2>
<p>Efetuar o download do pacote no site <a href="http://kaspersky.com/">kaspersky.com</a>:
Baixando e intalando o pacote mais atual (8.0.2):</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">wget http://products.kaspersky-labs.com/products/multilanguage/file_servers/kavlinuxserver8.0/linux/kav4fs_8.0.2-172_i386.deb</span>
<span class="l-Scalar-Plain">dpkg -i kav4fs_8.0.2-172_i386.deb</span>
<span class="l-Scalar-Plain">/opt/kaspersky/kav4fs/bin/kav4fs-setup.pl</span></code></pre></div>

<p>O processo de configuração do Kaspersky irá iniciar.</p>

<ul>
  <li>Configuração do proxy, caso exista: N</li>
  <li>Download da última base de dados (atualização): yes</li>
  <li>Agendar atualização: N</li>
  <li>Proteção do kernel em tempo real: yes</li>
  <li>Proteção do SAMBA: yes</li>
  <li>locale: pt_BR.utf8</li>
  <li>diretório do arquivo da licença trial: </li>
  <li>senha : Yes <em>**</em>
Ao final abra seu navegador e digite http://SEU_IP:9080</li>
</ul>

<figure>
 	<img src="/images/seguranca_linux/kaspersky-web.png" />
 </figure>

<h1 id="segurana-no-gestor-de-boot-grub">Segurança no gestor de boot: GRUB</h1>

<p>Instalando o pbkdf2</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">grub-mkpasswd-pbkdf2</span></code></pre></div>

<figure>
 	<img src="/images/seguranca_linux/pbkdf2.png" />
 </figure>
<p>Edite o arquivo /etc/grub.d/40_custom e adiciona a senha ao final do arquivo.</p>
<figure>
 	<img src="/images/seguranca_linux/40_custon.png" />
 </figure>
<p>Neste arquivo foi criado o usuário <code>lailson</code> e sua senha. Este usuário é o root, é o unico que poderar editar o grub. É possível adicionar novas usuário mas estes não poderão editar o grub.
Para efetivar a operaçao digite o comando <code>update-grub</code> para atualizar o grub. 
Ao reiniciar o sistema verá que se solicitar a tecla de edição “e” será solicitado usuário e senha.</p>
<figure>
 	<img src="/images/seguranca_linux/grub_senha.png" />
 </figure>

<h1 id="gerenciando-logs">Gerenciando Logs</h1>
<p>Os logs são responsável por registrar todas as ações no sistema em um arquivo. Podemos registrar:</p>

<ul>
  <li>Tentativas de conexão de usuários</li>
  <li>Páginas acessadas</li>
  <li>Registros do firewall como scanners e outros tipos de tentativas de invasão</li>
</ul>

<p>O RSyslog é uma versão avançada do syslog que vamos utilizar para gerenciar os log.</p>

<h2 id="configuraes-do-servidor-de-log">Configurações do servidor de log</h2>
<p>Neste exemplo o servidor vai ser a maquina que irá receber os log e tem o ip=192.168.0.17. </p>
<p>Devemos alterar o arquivo <code>vim /etc/rsyslog.conf</code> e descomentar as linhas:</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">$ModLoad imudp</span> 
<span class="l-Scalar-Plain">$UDPServerRun 514</span></code></pre></div>

<p>No arquivo <code>vim /etc/default/rsyslog</code> devemos adiconar ao final do arquivo:</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">RSYSLOGD_OPTIONS=&quot;-c0 -r&quot;</span></code></pre></div>

<p>Reiniciando o serviço com o comando <code>/etc/init.d/rsyslog restart</code>. Para visualizar os logs utilizaremos o comando <code>tail -f /var/log/auth.log</code>. 
Agora vamos configurar o cliente que irá enviar os logs para o servidor.</p>

<h2 id="configurando-o-cliente-de-log">Configurando o cliente de log</h2>
<p>Vamos alterar o arquivo de hosts do cliente.</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">192.168.0.17     lailson</span></code></pre></div>

<p>Agora vamos alterar o arquivo de configuração `vim /etc/rsyslog.conf`</p>

<div class="highlight"><pre><code class="yaml"><span class="err">*</span><span class="l-Scalar-Plain">.*       @lailson</span></code></pre></div>

<p>Adicionando isso ao final do arquivo podmos reiniciar o serviço `/etc/init.d/rsyslog restart`. Pronto! Se logarmos novamente no cliente o log de  </p>
<figure>
 	<img src="/images/seguranca_linux/logs.png" />
 </figure>
<p> Podemos ver na figura acima um terminal onde o lado esquerdo mostra a tela do servidor e o lado direito mostra a tela do cliente. Podemos ver que no lado direito foi feito autenticação de usuário e isso foi registrado no servidor (lado direito).</p>

<h2 id="gravando-os-logs-no-mysql">Gravando os logs no MySQL</h2>
<p>No servidor de log:</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">apt-get install rsyslog-mysql mysql-server</span>
<span class="l-Scalar-Plain">mysql -p</span>
    <span class="l-Scalar-Plain">mysql&gt; grant ALL ON Syslog.* to rsyslog@localhost identified by &#39;secret&#39;;</span>
    <span class="l-Scalar-Plain">mysql&gt; flush privileges;</span>
<span class="l-Scalar-Plain">vim /etc/rsyslog.d/mysql.conf</span>
    <span class="l-Scalar-Plain">$ModLoad ommysql</span>
    <span class="l-Scalar-Plain">*.* :ommysql:localhost,Syslog,rsyslog,secret</span></code></pre></div>

<p>Todos os logs estão sendo gravados no banco de dados mysql. Podemos entrar no mysql `mysql -p` e na tabela syslog `use Syslog` podemos ver todos os logs: `select * from SystemEvents`</p>

<h1 id="configurando-parties">Configurando Partições</h1>
<p>Para todas as partições montadas em um servidor, é importante verificar as opções que estão disponíveis, pois estas podem ser uma porta de entrada para intrusos.</p>
<p><code>nosuid</code> – Irá ignorar o bit SUID em um arquivo, fazendo com que ele se comporte como um executável convencional.<br />
<code>noexec</code> - Não permite a execução de arquivos nesta partição.<br />
<code>nodev</code>  - Não permite a utilização de arquivos de dispositivos nesta partição.<br />
<code>/tmp</code>   – Deve ter a opção noexec.<br />
<code>/usr</code>   - Pode ser montado como apenas leitura. Lembre que em alguns servidores a mudança de arquivos é feita em momentos muito específicos.<br />
<code>/var </code>  - É possível utilizarmos o noexec nesta partição.<br />
Alterações no <code>/etc/fstab</code></p>

